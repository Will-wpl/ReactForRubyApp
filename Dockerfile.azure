FROM ruby:2.4.1
ENV INSTALL_PATH /app
WORKDIR $INSTALL_PATH

ENV RAILS_ENV production
ENV RAILS_SERVE_STATIC_FILES=true    
ARG REDISTOGO_URL
ARG DATABASE_HOST
ARG DATABASE_PORT
ARG DATABASE_USERNAME
ARG DATABASE_PASSWORD
COPY . .

RUN bundle install -j4 && \
    yarn install

RUN chmod -R +x bin
RUN rake db:create
RUN rails assets:precompile
CMD ["rails", "server", "-b", "0.0.0.0", "-e", "production"]